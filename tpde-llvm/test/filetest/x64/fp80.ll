; NOTE: Assertions have been autogenerated by test/update_tpde_llc_test_checks.py UTC_ARGS: --version 5
; SPDX-FileCopyrightText: 2025 Contributors to TPDE <https://tpde.org>
; SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception

; RUN: tpde-llc --target=x86_64 %s | %objdump | FileCheck %s -check-prefixes=X64

define x86_fp80 @ret0() {
; X64-LABEL: <ret0>:
; X64:         fldz
; X64-NEXT:    ret
  ret x86_fp80 0xK00000000000000000000
}

define x86_fp80 @ret1() {
; X64-LABEL: <ret1>:
; X64:         fld1
; X64-NEXT:    ret
  ret x86_fp80 0xK3FFF8000000000000000
}

define x86_fp80 @ret2() {
; X64-LABEL: <ret2>:
; X64:         fld tbyte ptr <ret1+0xf>
; X64-NEXT:     R_X86_64_PC32 -0x4
; X64-NEXT:    ret
  ret x86_fp80 0xK3FEB8637BD05AF6C69B6
}

define x86_fp80 @arg_ret(x86_fp80 %p) {
; X64-LABEL: <arg_ret>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    fld tbyte ptr [rbp + 0x10]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  ret x86_fp80 %p
}

define x86_fp80 @call_ret() {
; X64-LABEL: <call_ret>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    sub rsp, 0x40
; X64-NEXT:  <L0>:
; X64-NEXT:    call <L0>
; X64-NEXT:     R_X86_64_PLT32 ret0-0x4
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    fld tbyte ptr [rbp - 0x40]
; X64-NEXT:    add rsp, 0x40
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %r = call x86_fp80 @ret0()
  ret x86_fp80 %r
}

define void @call_args(x86_fp80 %a, x86_fp80 %b) {
; X64-LABEL: <call_args>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    sub rsp, 0x50
; X64-NEXT:    movaps xmm0, xmmword ptr <call_args+0x7>
; X64-NEXT:     R_X86_64_PC32 -0x4
; X64-NEXT:    movdqa xmmword ptr [rsp], xmm0
; X64-NEXT:    movapd xmm0, xmmword ptr [rbp + 0x10]
; X64-NEXT:    movdqa xmmword ptr [rsp + 0x10], xmm0
; X64-NEXT:  <L0>:
; X64-NEXT:    call <L0>
; X64-NEXT:     R_X86_64_PLT32 call_args-0x4
; X64-NEXT:    add rsp, 0x50
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  call void @call_args(x86_fp80 0xK3FFF8000000000000000, x86_fp80 %a)
  ret void
}

define x86_fp80 @load_ret(ptr %p) {
; X64-LABEL: <load_ret>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    fld tbyte ptr [rdi]
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    fld tbyte ptr [rbp - 0x40]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %l = load x86_fp80, ptr %p
  ret x86_fp80 %l
}

define void @load_store(ptr %p, ptr %q) {
; X64-LABEL: <load_store>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    fld tbyte ptr [rdi]
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    fld tbyte ptr [rbp - 0x40]
; X64-NEXT:    fstp tbyte ptr [rsi]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %l = load x86_fp80, ptr %p
  store x86_fp80 %l, ptr %q
  ret void
}

define void @load_store_agg(ptr %p, ptr %q) {
; X64-LABEL: <load_store_agg>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    fld tbyte ptr [rdi]
; X64-NEXT:    fstp tbyte ptr [rbp - 0x70]
; X64-NEXT:    mov rax, qword ptr [rdi + 0x10]
; X64-NEXT:    movss xmm0, dword ptr [rdi + 0x18]
; X64-NEXT:    lea rcx, [rdi + 0x20]
; X64-NEXT:    fld tbyte ptr [rcx]
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    fld tbyte ptr [rbp - 0x70]
; X64-NEXT:    fstp tbyte ptr [rsi]
; X64-NEXT:    mov qword ptr [rsi + 0x10], rax
; X64-NEXT:    movss dword ptr [rsi + 0x18], xmm0
; X64-NEXT:    fld tbyte ptr [rbp - 0x40]
; X64-NEXT:    lea rax, [rsi + 0x20]
; X64-NEXT:    fstp tbyte ptr [rax]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %l = load {x86_fp80, i64, float, x86_fp80}, ptr %p
  store {x86_fp80, i64, float, x86_fp80} %l, ptr %q
  ret void
}

define void @store_const(ptr %p) {
; X64-LABEL: <store_const>:
; X64:         fld1
; X64-NEXT:    fstp tbyte ptr [rdi]
; X64-NEXT:    ret
  store x86_fp80 0xK3FFF8000000000000000, ptr %p
  ret void
}

define float @trunc_float(x86_fp80 %v) {
; X64-LABEL: <trunc_float>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    fld tbyte ptr [rbp + 0x10]
; X64-NEXT:    fstp dword ptr [rbp - 0x2c]
; X64-NEXT:    movd xmm0, dword ptr [rbp - 0x2c]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %t = fptrunc x86_fp80 %v to float
  ret float %t
}

define double @trunc_double(x86_fp80 %v) {
; X64-LABEL: <trunc_double>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    fld tbyte ptr [rbp + 0x10]
; X64-NEXT:    fstp qword ptr [rbp - 0x30]
; X64-NEXT:    movq xmm0, qword ptr [rbp - 0x30]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %t = fptrunc x86_fp80 %v to double
  ret double %t
}

define x86_fp80 @ext_float(float %v) {
; X64-LABEL: <ext_float>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    movd dword ptr [rbp - 0x2c], xmm0
; X64-NEXT:    fld dword ptr [rbp - 0x2c]
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    fld tbyte ptr [rbp - 0x40]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %e = fpext float %v to x86_fp80
  ret x86_fp80 %e
}

define x86_fp80 @ext_double(double %v) {
; X64-LABEL: <ext_double>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    movq qword ptr [rbp - 0x30], xmm0
; X64-NEXT:    fld qword ptr [rbp - 0x30]
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    fld tbyte ptr [rbp - 0x40]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %e = fpext double %v to x86_fp80
  ret x86_fp80 %e
}

define x86_fp80 @sitofp_16(i16 %v) {
; X64-LABEL: <sitofp_16>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    movsx edi, di
; X64-NEXT:    mov dword ptr [rbp - 0x40], edi
; X64-NEXT:    fild dword ptr [rbp - 0x40]
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    fld tbyte ptr [rbp - 0x40]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %e = sitofp i16 %v to x86_fp80
  ret x86_fp80 %e
}

define x86_fp80 @sitofp_32(i32 %v) {
; X64-LABEL: <sitofp_32>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    mov dword ptr [rbp - 0x44], edi
; X64-NEXT:    fild dword ptr [rbp - 0x44]
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    fld tbyte ptr [rbp - 0x40]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %e = sitofp i32 %v to x86_fp80
  ret x86_fp80 %e
}

define x86_fp80 @sitofp_37(i37 %v) {
; X64-LABEL: <sitofp_37>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    shl rdi, 0x1b
; X64-NEXT:    sar rdi, 0x1b
; X64-NEXT:    mov qword ptr [rbp - 0x40], rdi
; X64-NEXT:    fild qword ptr [rbp - 0x40]
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    fld tbyte ptr [rbp - 0x40]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %e = sitofp i37 %v to x86_fp80
  ret x86_fp80 %e
}

define x86_fp80 @sitofp_64(i64 %v) {
; X64-LABEL: <sitofp_64>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    mov qword ptr [rbp - 0x30], rdi
; X64-NEXT:    fild qword ptr [rbp - 0x30]
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    fld tbyte ptr [rbp - 0x40]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %e = sitofp i64 %v to x86_fp80
  ret x86_fp80 %e
}

define x86_fp80 @uitofp_16(i16 %v) {
; X64-LABEL: <uitofp_16>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    movzx edi, di
; X64-NEXT:    mov edi, edi
; X64-NEXT:    mov qword ptr [rbp - 0x40], rdi
; X64-NEXT:    fild qword ptr [rbp - 0x40]
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    fld tbyte ptr [rbp - 0x40]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %e = uitofp i16 %v to x86_fp80
  ret x86_fp80 %e
}

define x86_fp80 @uitofp_32(i32 %v) {
; X64-LABEL: <uitofp_32>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    mov edi, edi
; X64-NEXT:    mov qword ptr [rbp - 0x40], rdi
; X64-NEXT:    fild qword ptr [rbp - 0x40]
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    fld tbyte ptr [rbp - 0x40]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %e = uitofp i32 %v to x86_fp80
  ret x86_fp80 %e
}

define x86_fp80 @uitofp_37(i37 %v) {
; X64-LABEL: <uitofp_37>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    movabs rax, 0x1fffffffff
; X64-NEXT:    and rdi, rax
; X64-NEXT:    mov qword ptr [rbp - 0x40], rdi
; X64-NEXT:    fild qword ptr [rbp - 0x40]
; X64-NEXT:    shr rdi, 0x3f
; X64-NEXT:    lea rax, <uitofp_37+0x1b>
; X64-NEXT:     R_X86_64_PC32 -0x4
; X64-NEXT:    fadd dword ptr [rax + 4*rdi]
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    fld tbyte ptr [rbp - 0x40]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %e = uitofp i37 %v to x86_fp80
  ret x86_fp80 %e
}

define x86_fp80 @uitofp_64(i64 %v) {
; X64-LABEL: <uitofp_64>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    mov qword ptr [rbp - 0x30], rdi
; X64-NEXT:    fild qword ptr [rbp - 0x30]
; X64-NEXT:    shr rdi, 0x3f
; X64-NEXT:    lea rax, <uitofp_64+0xe>
; X64-NEXT:     R_X86_64_PC32 -0x4
; X64-NEXT:    fadd dword ptr [rax + 4*rdi]
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    fld tbyte ptr [rbp - 0x40]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %e = uitofp i64 %v to x86_fp80
  ret x86_fp80 %e
}

define x86_fp80 @uitofp_16_twice(i16 %v) {
; X64-LABEL: <uitofp_16_twice>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    movzx eax, di
; X64-NEXT:    mov eax, eax
; X64-NEXT:    mov qword ptr [rbp - 0x40], rax
; X64-NEXT:    fild qword ptr [rbp - 0x40]
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    movzx edi, di
; X64-NEXT:    mov edi, edi
; X64-NEXT:    mov qword ptr [rbp - 0x40], rdi
; X64-NEXT:    fild qword ptr [rbp - 0x40]
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    fld tbyte ptr [rbp - 0x40]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %e1 = uitofp i16 %v to x86_fp80
  %e2 = uitofp i16 %v to x86_fp80
  ret x86_fp80 %e2
}

define x86_fp80 @uitofp_32_twice(i32 %v) {
; X64-LABEL: <uitofp_32_twice>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    mov eax, edi
; X64-NEXT:    mov qword ptr [rbp - 0x40], rax
; X64-NEXT:    fild qword ptr [rbp - 0x40]
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    mov edi, edi
; X64-NEXT:    mov qword ptr [rbp - 0x40], rdi
; X64-NEXT:    fild qword ptr [rbp - 0x40]
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    fld tbyte ptr [rbp - 0x40]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %e1 = uitofp i32 %v to x86_fp80
  %e2 = uitofp i32 %v to x86_fp80
  ret x86_fp80 %e2
}

define x86_fp80 @uitofp_37_twice(i37 %v) {
; X64-LABEL: <uitofp_37_twice>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    movabs rax, 0x1fffffffff
; X64-NEXT:    and rax, rdi
; X64-NEXT:    mov qword ptr [rbp - 0x40], rax
; X64-NEXT:    fild qword ptr [rbp - 0x40]
; X64-NEXT:    shr rax, 0x3f
; X64-NEXT:    lea rcx, <uitofp_37_twice+0x1b>
; X64-NEXT:     R_X86_64_PC32 -0x4
; X64-NEXT:    fadd dword ptr [rcx + 4*rax]
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    movabs rax, 0x1fffffffff
; X64-NEXT:    and rdi, rax
; X64-NEXT:    mov qword ptr [rbp - 0x40], rdi
; X64-NEXT:    fild qword ptr [rbp - 0x40]
; X64-NEXT:    shr rdi, 0x3f
; X64-NEXT:    lea rax, <uitofp_37_twice+0x40>
; X64-NEXT:     R_X86_64_PC32 -0x4
; X64-NEXT:    fadd dword ptr [rax + 4*rdi]
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    fld tbyte ptr [rbp - 0x40]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %e1 = uitofp i37 %v to x86_fp80
  %e2 = uitofp i37 %v to x86_fp80
  ret x86_fp80 %e2
}

define x86_fp80 @uitofp_64_twice(i64 %v) {
; X64-LABEL: <uitofp_64_twice>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    mov qword ptr [rbp - 0x30], rdi
; X64-NEXT:    fild qword ptr [rbp - 0x30]
; X64-NEXT:    mov rax, rdi
; X64-NEXT:    shr rax, 0x3f
; X64-NEXT:    lea rcx, <uitofp_64_twice+0x11>
; X64-NEXT:     R_X86_64_PC32 -0x4
; X64-NEXT:    fadd dword ptr [rcx + 4*rax]
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    fild qword ptr [rbp - 0x30]
; X64-NEXT:    shr rdi, 0x3f
; X64-NEXT:    lea rax, <uitofp_64_twice+0x25>
; X64-NEXT:     R_X86_64_PC32 -0x4
; X64-NEXT:    fadd dword ptr [rax + 4*rdi]
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    fld tbyte ptr [rbp - 0x40]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %e1 = uitofp i64 %v to x86_fp80
  %e2 = uitofp i64 %v to x86_fp80
  ret x86_fp80 %e2
}

define i1 @fcmp_false(x86_fp80 %0, x86_fp80 %1) {
; X64-LABEL: <fcmp_false>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    xor eax, eax
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %cmp = fcmp false x86_fp80 %0, %1
  ret i1 %cmp
}

define i1 @fcmp_true(x86_fp80 %0, x86_fp80 %1) {
; X64-LABEL: <fcmp_true>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    mov eax, 0x1
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %cmp = fcmp true x86_fp80 %0, %1
  ret i1 %cmp
}

define i1 @fcmp_oge(x86_fp80 %0, x86_fp80 %1) {
; X64-LABEL: <fcmp_oge>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    fld tbyte ptr [rbp + 0x20]
; X64-NEXT:    fld tbyte ptr [rbp + 0x10]
; X64-NEXT:    fucompi st, st(1)
; X64-NEXT:    fstp st(0)
; X64-NEXT:    setae al
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %cmp = fcmp oge x86_fp80 %0, %1
  ret i1 %cmp
}

define i1 @fcmp_ord(x86_fp80 %0, x86_fp80 %1) {
; X64-LABEL: <fcmp_ord>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    fld tbyte ptr [rbp + 0x20]
; X64-NEXT:    fld tbyte ptr [rbp + 0x10]
; X64-NEXT:    fucompi st, st(1)
; X64-NEXT:    fstp st(0)
; X64-NEXT:    setnp al
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %cmp = fcmp ord x86_fp80 %0, %1
  ret i1 %cmp
}

define i1 @fcmp_oeq(x86_fp80 %0, x86_fp80 %1) {
; X64-LABEL: <fcmp_oeq>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    fld tbyte ptr [rbp + 0x20]
; X64-NEXT:    fld tbyte ptr [rbp + 0x10]
; X64-NEXT:    fucompi st, st(1)
; X64-NEXT:    fstp st(0)
; X64-NEXT:    setnp cl
; X64-NEXT:    sete al
; X64-NEXT:    and al, cl
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %cmp = fcmp oeq x86_fp80 %0, %1
  ret i1 %cmp
}

define i1 @fcmp_ogt(x86_fp80 %0, x86_fp80 %1) {
; X64-LABEL: <fcmp_ogt>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    fld tbyte ptr [rbp + 0x20]
; X64-NEXT:    fld tbyte ptr [rbp + 0x10]
; X64-NEXT:    fucompi st, st(1)
; X64-NEXT:    fstp st(0)
; X64-NEXT:    seta al
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %cmp = fcmp ogt x86_fp80 %0, %1
  ret i1 %cmp
}

define i1 @fcmp_olt(x86_fp80 %0, x86_fp80 %1) {
; X64-LABEL: <fcmp_olt>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    fld tbyte ptr [rbp + 0x10]
; X64-NEXT:    fld tbyte ptr [rbp + 0x20]
; X64-NEXT:    fucompi st, st(1)
; X64-NEXT:    fstp st(0)
; X64-NEXT:    seta al
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %cmp = fcmp olt x86_fp80 %0, %1
  ret i1 %cmp
}

define i1 @fcmp_ole(x86_fp80 %0, x86_fp80 %1) {
; X64-LABEL: <fcmp_ole>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    fld tbyte ptr [rbp + 0x10]
; X64-NEXT:    fld tbyte ptr [rbp + 0x20]
; X64-NEXT:    fucompi st, st(1)
; X64-NEXT:    fstp st(0)
; X64-NEXT:    setae al
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %cmp = fcmp ole x86_fp80 %0, %1
  ret i1 %cmp
}

define i1 @fcmp_uno(x86_fp80 %0, x86_fp80 %1) {
; X64-LABEL: <fcmp_uno>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    fld tbyte ptr [rbp + 0x20]
; X64-NEXT:    fld tbyte ptr [rbp + 0x10]
; X64-NEXT:    fucompi st, st(1)
; X64-NEXT:    fstp st(0)
; X64-NEXT:    setp al
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %cmp = fcmp uno x86_fp80 %0, %1
  ret i1 %cmp
}

define i1 @fcmp_ugt(x86_fp80 %0, x86_fp80 %1) {
; X64-LABEL: <fcmp_ugt>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    fld tbyte ptr [rbp + 0x10]
; X64-NEXT:    fld tbyte ptr [rbp + 0x20]
; X64-NEXT:    fucompi st, st(1)
; X64-NEXT:    fstp st(0)
; X64-NEXT:    setb al
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %cmp = fcmp ugt x86_fp80 %0, %1
  ret i1 %cmp
}

define i1 @fcmp_uge(x86_fp80 %0, x86_fp80 %1) {
; X64-LABEL: <fcmp_uge>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    fld tbyte ptr [rbp + 0x10]
; X64-NEXT:    fld tbyte ptr [rbp + 0x20]
; X64-NEXT:    fucompi st, st(1)
; X64-NEXT:    fstp st(0)
; X64-NEXT:    setbe al
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %cmp = fcmp uge x86_fp80 %0, %1
  ret i1 %cmp
}

define i1 @fcmp_ult(x86_fp80 %0, x86_fp80 %1) {
; X64-LABEL: <fcmp_ult>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    fld tbyte ptr [rbp + 0x20]
; X64-NEXT:    fld tbyte ptr [rbp + 0x10]
; X64-NEXT:    fucompi st, st(1)
; X64-NEXT:    fstp st(0)
; X64-NEXT:    setb al
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %cmp = fcmp ult x86_fp80 %0, %1
  ret i1 %cmp
}

define i1 @fcmp_ule(x86_fp80 %0, x86_fp80 %1) {
; X64-LABEL: <fcmp_ule>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    fld tbyte ptr [rbp + 0x20]
; X64-NEXT:    fld tbyte ptr [rbp + 0x10]
; X64-NEXT:    fucompi st, st(1)
; X64-NEXT:    fstp st(0)
; X64-NEXT:    setbe al
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %cmp = fcmp ule x86_fp80 %0, %1
  ret i1 %cmp
}

define i1 @fcmp_une(x86_fp80 %0, x86_fp80 %1) {
; X64-LABEL: <fcmp_une>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    fld tbyte ptr [rbp + 0x20]
; X64-NEXT:    fld tbyte ptr [rbp + 0x10]
; X64-NEXT:    fucompi st, st(1)
; X64-NEXT:    fstp st(0)
; X64-NEXT:    setp cl
; X64-NEXT:    setne al
; X64-NEXT:    or al, cl
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %cmp = fcmp une x86_fp80 %0, %1
  ret i1 %cmp
}

define i1 @fcmp_one(x86_fp80 %0, x86_fp80 %1) {
; X64-LABEL: <fcmp_one>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    fld tbyte ptr [rbp + 0x20]
; X64-NEXT:    fld tbyte ptr [rbp + 0x10]
; X64-NEXT:    fucompi st, st(1)
; X64-NEXT:    fstp st(0)
; X64-NEXT:    setne al
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %cmp = fcmp one x86_fp80 %0, %1
  ret i1 %cmp
}

define i1 @fcmp_ueq(x86_fp80 %0, x86_fp80 %1) {
; X64-LABEL: <fcmp_ueq>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    fld tbyte ptr [rbp + 0x20]
; X64-NEXT:    fld tbyte ptr [rbp + 0x10]
; X64-NEXT:    fucompi st, st(1)
; X64-NEXT:    fstp st(0)
; X64-NEXT:    sete al
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %cmp = fcmp ueq x86_fp80 %0, %1
  ret i1 %cmp
}

define x86_fp80 @select(i1 %c, x86_fp80 %a, x86_fp80 %b) {
; X64-LABEL: <select>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    test dil, 0x1
; X64-NEXT:    movapd xmm0, xmmword ptr [rbp + 0x10]
; X64-NEXT:    movapd xmm1, xmmword ptr [rbp + 0x20]
; X64-NEXT:    je <L0>
; X64-NEXT:    movaps xmm1, xmm0
; X64-NEXT:  <L0>:
; X64-NEXT:    movaps xmm0, xmm1
; X64-NEXT:    movapd xmmword ptr [rbp - 0x40], xmm0
; X64-NEXT:    fld tbyte ptr [rbp - 0x40]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %res = select i1 %c, x86_fp80 %a, x86_fp80 %b
  ret x86_fp80 %res
}

define x86_fp80 @fadd(x86_fp80 %0, x86_fp80 %1) {
; X64-LABEL: <fadd>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    fld tbyte ptr [rbp + 0x20]
; X64-NEXT:    fld tbyte ptr [rbp + 0x10]
; X64-NEXT:    faddp st(1), st
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    fld tbyte ptr [rbp - 0x40]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %res = fadd x86_fp80 %0, %1
  ret x86_fp80 %res
}

define x86_fp80 @fsub(x86_fp80 %0, x86_fp80 %1) {
; X64-LABEL: <fsub>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    fld tbyte ptr [rbp + 0x20]
; X64-NEXT:    fld tbyte ptr [rbp + 0x10]
; X64-NEXT:    fsubrp st(1), st
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    fld tbyte ptr [rbp - 0x40]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %res = fsub x86_fp80 %0, %1
  ret x86_fp80 %res
}

define x86_fp80 @fmul(x86_fp80 %0, x86_fp80 %1) {
; X64-LABEL: <fmul>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    fld tbyte ptr [rbp + 0x20]
; X64-NEXT:    fld tbyte ptr [rbp + 0x10]
; X64-NEXT:    fmulp st(1), st
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    fld tbyte ptr [rbp - 0x40]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %res = fmul x86_fp80 %0, %1
  ret x86_fp80 %res
}

define x86_fp80 @fdiv(x86_fp80 %0, x86_fp80 %1) {
; X64-LABEL: <fdiv>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    fld tbyte ptr [rbp + 0x20]
; X64-NEXT:    fld tbyte ptr [rbp + 0x10]
; X64-NEXT:    fdivrp st(1), st
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    fld tbyte ptr [rbp - 0x40]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %res = fdiv x86_fp80 %0, %1
  ret x86_fp80 %res
}

define x86_fp80 @fneg(x86_fp80 %0) {
; X64-LABEL: <fneg>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    fld tbyte ptr [rbp + 0x10]
; X64-NEXT:    fchs
; X64-NEXT:    fstp tbyte ptr [rbp - 0x40]
; X64-NEXT:    fld tbyte ptr [rbp - 0x40]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
  %res = fneg x86_fp80 %0
  ret x86_fp80 %res
}
