; NOTE: Assertions have been autogenerated by test/update_tpde_llc_test_checks.py UTC_ARGS: --version 5
; SPDX-FileCopyrightText: 2025 Contributors to TPDE <https://tpde.org>
;
; SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception

; RUN: tpde-llc --target=x86_64 %s | %objdump | FileCheck %s -check-prefixes=X64
; RUN: tpde-llc --target=aarch64 %s | %objdump | FileCheck %s -check-prefixes=ARM64

declare float @llvm.fabs.f32(float)
declare double @llvm.fabs.f64(double)

define float @fabsf32(float %0) {
; X64-LABEL: <fabsf32>:
; X64:         andps xmm0, xmmword ptr <fabsf32>
; X64-NEXT:     R_X86_64_PC32 -0x4
; X64-NEXT:    ret
;
; ARM64-LABEL: <fabsf32>:
; ARM64:         fabs s0, s0
; ARM64-NEXT:    ret
entry:
  %1 = call float @llvm.fabs.f32(float %0)
  ret float %1
}

define double @fabsf64(double %0) {
; X64-LABEL: <fabsf64>:
; X64:         andps xmm0, xmmword ptr <fabsf64>
; X64-NEXT:     R_X86_64_PC32 -0x4
; X64-NEXT:    ret
;
; ARM64-LABEL: <fabsf64>:
; ARM64:         fabs d0, d0
; ARM64-NEXT:    ret
entry:
  %1 = call double @llvm.fabs.f64(double %0)
  ret double %1
}

define fp128 @fabsf128(fp128 %v) {
; X64-LABEL: <fabsf128>:
; X64:         andps xmm0, xmmword ptr <fabsf128>
; X64-NEXT:     R_X86_64_PC32 -0x4
; X64-NEXT:    ret
;
; ARM64-LABEL: <fabsf128>:
; ARM64:         str q0, [sp, #-0x10]!
; ARM64-NEXT:    ldrb w0, [sp, #0xf]
; ARM64-NEXT:    and w0, w0, #0x7f
; ARM64-NEXT:    strb w0, [sp, #0xf]
; ARM64-NEXT:    ldr q0, [sp], #0x10
; ARM64-NEXT:    ret
  %r = call fp128 @llvm.fabs(fp128 %v)
  ret fp128 %r
}
