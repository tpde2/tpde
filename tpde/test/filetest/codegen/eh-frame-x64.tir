; NOTE: Assertions have been autogenerated by test/update_tpde_llc_test_checks.py UTC_ARGS: --tool tpde_test --version 5
; SPDX-FileCopyrightText: 2025 Contributors to TPDE <https://tpde.org>
; SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception

; RUN: tpde_test --target=x86_64 %s | llvm-dwarfdump --eh-frame - | FileCheck %s -check-prefixes=EH
; RUN: tpde_test --target=x86_64 %s | llvm-objdump -d --no-show-raw-insn -M intel - | FileCheck %s -check-prefixes=ASM

; NOTE: EH checks must be updated manually.

; EH: 00000000 00000014 00000000 CIE
; EH-NEXT:   Format:                DWARF32
; EH-NEXT:   Version:               1
; EH-NEXT:   Augmentation:          "zR"
; EH-NEXT:   Code alignment factor: 1
; EH-NEXT:   Data alignment factor: -8
; EH-NEXT:   Return address column: 16
; EH-NEXT:   Augmentation data:     1B
; EH-EMPTY:
; EH-NEXT:   DW_CFA_def_cfa: RSP +8
; EH-NEXT:   DW_CFA_offset: RIP -8
; EH-NEXT:   DW_CFA_nop:
; EH-NEXT:   DW_CFA_nop:
; EH-EMPTY:

define @add1(%a, %b) {
; EH-LABEL: FDE cie=00000000 pc=00000000...00000007
; EH-NEXT: Format:       DWARF32
; EH-NEXT: DW_CFA_nop:
; EH-NEXT: DW_CFA_nop:
; EH-NEXT: DW_CFA_nop:
; EH-NEXT: DW_CFA_nop:
; EH-NEXT: DW_CFA_nop:
; EH-NEXT: DW_CFA_nop:
; EH-NEXT: DW_CFA_nop:
; EH-EMPTY:
; ASM-LABEL: <add1>:
; ASM:         0: add rdi, rsi
; ASM-NEXT:    3: mov rax, rdi
; ASM-NEXT:    6: ret
; ASM-NEXT:    7: nop word ptr [rax + rax]
entry:
  %res = add %a, %b
  ret %res
}

define @add2(%a, %b) {
; EH-LABEL: FDE cie=00000000 pc=00000010...000001dd
; EH-NEXT: Format:       DWARF32
; EH-NEXT: DW_CFA_advance_loc: 1 to 0x11
; EH-NEXT: DW_CFA_def_cfa_offset: +16
; EH-NEXT: DW_CFA_offset: RBP -16
; EH-NEXT: DW_CFA_advance_loc: 3 to 0x14
; EH-NEXT: DW_CFA_def_cfa_register: RBP
; EH-NEXT: DW_CFA_advance_loc: 16 to 0x24
; EH-NEXT: DW_CFA_offset: RBX -24
; EH-NEXT: DW_CFA_offset: R12 -32
; EH-NEXT: DW_CFA_offset: R13 -40
; EH-NEXT: DW_CFA_offset: R14 -48
; EH-NEXT: DW_CFA_offset: R15 -56
; EH-NEXT: DW_CFA_nop:
; EH-NEXT: DW_CFA_nop:
; EH-NEXT: DW_CFA_nop:
; EH-NEXT: DW_CFA_nop:
; EH-EMPTY:
; ASM-LABEL: <add2>:
; ASM:         10: push rbp
; ASM-NEXT:    11: mov rbp, rsp
; ASM-NEXT:    14: push rbx
; ASM-NEXT:    15: push r12
; ASM-NEXT:    17: push r13
; ASM-NEXT:    19: push r14
; ASM-NEXT:    1b: push r15
; ASM-NEXT:    1d: sub rsp, 0x98
; ASM-NEXT:    24: lea rax, [rdi + rsi]
; ASM-NEXT:    28: lea rcx, [rdi + rsi]
; ASM-NEXT:    2c: lea rdx, [rdi + rsi]
; ASM-NEXT:    30: lea rbx, [rdi + rsi]
; ASM-NEXT:    34: lea r8, [rdi + rsi]
; ASM-NEXT:    38: lea r9, [rdi + rsi]
; ASM-NEXT:    3c: lea r10, [rdi + rsi]
; ASM-NEXT:    40: lea r11, [rdi + rsi]
; ASM-NEXT:    44: lea r12, [rdi + rsi]
; ASM-NEXT:    48: lea r13, [rdi + rsi]
; ASM-NEXT:    4c: lea r14, [rdi + rsi]
; ASM-NEXT:    50: lea r15, [rdi + rsi]
; ASM-NEXT:    54: mov qword ptr [rbp - 0x30], rax
; ASM-NEXT:    58: lea rax, [rdi + rsi]
; ASM-NEXT:    5c: mov qword ptr [rbp - 0x38], rax
; ASM-NEXT:    60: lea rax, [rdi + rsi]
; ASM-NEXT:    64: mov qword ptr [rbp - 0x40], rax
; ASM-NEXT:    68: lea rax, [rdi + rsi]
; ASM-NEXT:    6c: mov qword ptr [rbp - 0x48], rax
; ASM-NEXT:    70: lea rax, [rdi + rsi]
; ASM-NEXT:    74: mov qword ptr [rbp - 0x50], rax
; ASM-NEXT:    78: lea rax, [rdi + rsi]
; ASM-NEXT:    7c: mov qword ptr [rbp - 0x58], rax
; ASM-NEXT:    80: lea rax, [rdi + rsi]
; ASM-NEXT:    84: mov qword ptr [rbp - 0x60], rax
; ASM-NEXT:    88: lea rax, [rdi + rsi]
; ASM-NEXT:    8c: mov qword ptr [rbp - 0x68], rax
; ASM-NEXT:    90: lea rax, [rdi + rsi]
; ASM-NEXT:    94: mov qword ptr [rbp - 0x70], rax
; ASM-NEXT:    98: lea rax, [rdi + rsi]
; ASM-NEXT:    9c: mov qword ptr [rbp - 0x78], rax
; ASM-NEXT:    a0: lea rax, [rdi + rsi]
; ASM-NEXT:    a4: mov qword ptr [rbp - 0x80], rax
; ASM-NEXT:    a8: lea rax, [rdi + rsi]
; ASM-NEXT:    ac: mov qword ptr [rbp - 0x88], rax
; ASM-NEXT:    b3: lea rax, [rdi + rsi]
; ASM-NEXT:    b7: mov qword ptr [rbp - 0x90], rax
; ASM-NEXT:    be: lea rax, [rdi + rsi]
; ASM-NEXT:    c2: mov qword ptr [rbp - 0x98], rax
; ASM-NEXT:    c9: lea rax, [rdi + rsi]
; ASM-NEXT:    cd: mov qword ptr [rbp - 0xa0], rax
; ASM-NEXT:    d4: lea rax, [rdi + rsi]
; ASM-NEXT:    d8: mov qword ptr [rbp - 0xa8], rax
; ASM-NEXT:    df: lea rax, [rdi + rsi]
; ASM-NEXT:    e3: mov qword ptr [rbp - 0xb0], rax
; ASM-NEXT:    ea: lea rax, [rdi + rsi]
; ASM-NEXT:    ee: mov qword ptr [rbp - 0xb8], rax
; ASM-NEXT:    f5: lea rax, [rdi + rsi]
; ASM-NEXT:    f9: mov qword ptr [rbp - 0xc0], rax
; ASM-NEXT:    100: lea rax, [rdi + rsi]
; ASM-NEXT:    104: add rdi, rsi
; ASM-NEXT:    107: mov rsi, qword ptr [rbp - 0x30]
; ASM-NEXT:    10b: add rsi, rcx
; ASM-NEXT:    10e: add rsi, rdx
; ASM-NEXT:    111: add rsi, rbx
; ASM-NEXT:    114: add rsi, r8
; ASM-NEXT:    117: add rsi, r9
; ASM-NEXT:    11a: add rsi, r10
; ASM-NEXT:    11d: add rsi, r11
; ASM-NEXT:    120: add rsi, r12
; ASM-NEXT:    123: add rsi, r13
; ASM-NEXT:    126: add rsi, r14
; ASM-NEXT:    129: add rsi, r15
; ASM-NEXT:    12c: mov rcx, qword ptr [rbp - 0x38]
; ASM-NEXT:    130: add rsi, rcx
; ASM-NEXT:    133: mov rcx, qword ptr [rbp - 0x40]
; ASM-NEXT:    137: add rsi, rcx
; ASM-NEXT:    13a: mov rcx, qword ptr [rbp - 0x48]
; ASM-NEXT:    13e: add rsi, rcx
; ASM-NEXT:    141: mov rcx, qword ptr [rbp - 0x50]
; ASM-NEXT:    145: add rsi, rcx
; ASM-NEXT:    148: mov rcx, qword ptr [rbp - 0x58]
; ASM-NEXT:    14c: add rsi, rcx
; ASM-NEXT:    14f: mov rcx, qword ptr [rbp - 0x60]
; ASM-NEXT:    153: add rsi, rcx
; ASM-NEXT:    156: mov rcx, qword ptr [rbp - 0x68]
; ASM-NEXT:    15a: add rsi, rcx
; ASM-NEXT:    15d: mov rcx, qword ptr [rbp - 0x70]
; ASM-NEXT:    161: add rsi, rcx
; ASM-NEXT:    164: mov rcx, qword ptr [rbp - 0x78]
; ASM-NEXT:    168: add rsi, rcx
; ASM-NEXT:    16b: mov rcx, qword ptr [rbp - 0x80]
; ASM-NEXT:    16f: add rsi, rcx
; ASM-NEXT:    172: mov rcx, qword ptr [rbp - 0x88]
; ASM-NEXT:    179: add rsi, rcx
; ASM-NEXT:    17c: mov rcx, qword ptr [rbp - 0x90]
; ASM-NEXT:    183: add rsi, rcx
; ASM-NEXT:    186: mov rcx, qword ptr [rbp - 0x98]
; ASM-NEXT:    18d: add rsi, rcx
; ASM-NEXT:    190: mov rcx, qword ptr [rbp - 0xa0]
; ASM-NEXT:    197: add rsi, rcx
; ASM-NEXT:    19a: mov rcx, qword ptr [rbp - 0xa8]
; ASM-NEXT:    1a1: add rsi, rcx
; ASM-NEXT:    1a4: mov rcx, qword ptr [rbp - 0xb0]
; ASM-NEXT:    1ab: add rsi, rcx
; ASM-NEXT:    1ae: mov rcx, qword ptr [rbp - 0xb8]
; ASM-NEXT:    1b5: add rsi, rcx
; ASM-NEXT:    1b8: mov rcx, qword ptr [rbp - 0xc0]
; ASM-NEXT:    1bf: add rsi, rcx
; ASM-NEXT:    1c2: add rsi, rax
; ASM-NEXT:    1c5: add rsi, rdi
; ASM-NEXT:    1c8: mov rax, rsi
; ASM-NEXT:    1cb: add rsp, 0x98
; ASM-NEXT:    1d2: pop r15
; ASM-NEXT:    1d4: pop r14
; ASM-NEXT:    1d6: pop r13
; ASM-NEXT:    1d8: pop r12
; ASM-NEXT:    1da: pop rbx
; ASM-NEXT:    1db: pop rbp
; ASM-NEXT:    1dc: ret
entry:
  %a0 = add %a, %b
  %a1 = add %a, %b
  %a2 = add %a, %b
  %a3 = add %a, %b
  %a4 = add %a, %b
  %a5 = add %a, %b
  %a6 = add %a, %b
  %a7 = add %a, %b
  %a8 = add %a, %b
  %a9 = add %a, %b
  %a10 = add %a, %b
  %a11 = add %a, %b
  %a12 = add %a, %b
  %a13 = add %a, %b
  %a14 = add %a, %b
  %a15 = add %a, %b
  %a16 = add %a, %b
  %a17 = add %a, %b
  %a18 = add %a, %b
  %a19 = add %a, %b
  %a20 = add %a, %b
  %a21 = add %a, %b
  %a22 = add %a, %b
  %a23 = add %a, %b
  %a24 = add %a, %b
  %a25 = add %a, %b
  %a26 = add %a, %b
  %a27 = add %a, %b
  %a28 = add %a, %b
  %a29 = add %a, %b
  %a30 = add %a, %b
  %a31 = add %a, %b
  %s1 = add %a0, %a1
  %s2 = add %s1, %a2
  %s3 = add %s2, %a3
  %s4 = add %s3, %a4
  %s5 = add %s4, %a5
  %s6 = add %s5, %a6
  %s7 = add %s6, %a7
  %s8 = add %s7, %a8
  %s9 = add %s8, %a9
  %s10 = add %s9, %a10
  %s11 = add %s10, %a11
  %s12 = add %s11, %a12
  %s13 = add %s12, %a13
  %s14 = add %s13, %a14
  %s15 = add %s14, %a15
  %s16 = add %s15, %a16
  %s17 = add %s16, %a17
  %s18 = add %s17, %a18
  %s19 = add %s18, %a19
  %s20 = add %s19, %a20
  %s21 = add %s20, %a21
  %s22 = add %s21, %a22
  %s23 = add %s22, %a23
  %s24 = add %s23, %a24
  %s25 = add %s24, %a25
  %s26 = add %s25, %a26
  %s27 = add %s26, %a27
  %s28 = add %s27, %a28
  %s29 = add %s28, %a29
  %s30 = add %s29, %a30
  %s31 = add %s30, %a31
  ret %s31
}
