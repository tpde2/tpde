; NOTE: Assertions have been autogenerated by test/update_tpde_llc_test_checks.py UTC_ARGS: --tool tpde_test --version 5
; SPDX-FileCopyrightText: 2025 Contributors to TPDE <https://tpde.org>
; SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception

; RUN: tpde_test --target=x86_64 %s --no-fixed-assignments | %objdump | FileCheck %s --check-prefixes=X64
; RUN: tpde_test --target=aarch64 %s --no-fixed-assignments | %objdump | FileCheck %s --check-prefixes=ARM64

define @alloca1() {
; X64-LABEL: <alloca1>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    lea rax, [rbp - 0x30]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
;
; ARM64-LABEL: <alloca1>:
; ARM64:         stp x29, x30, [sp, #-0xb0]!
; ARM64-NEXT:    mov x29, sp
; ARM64-NEXT:    add x0, x29, #0xa0
; ARM64-NEXT:    ldp x29, x30, [sp], #0xb0
; ARM64-NEXT:    ret
entry:
  %a = alloca 8, 8
  ret %a
}

define @alloca2() {
; X64-LABEL: <alloca2>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    lea rax, [rbp - 0x50]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
;
; ARM64-LABEL: <alloca2>:
; ARM64:         stp x29, x30, [sp, #-0xc0]!
; ARM64-NEXT:    mov x29, sp
; ARM64-NEXT:    add x0, x29, #0xa0
; ARM64-NEXT:    ldp x29, x30, [sp], #0xc0
; ARM64-NEXT:    ret
entry:
  %a = alloca 24, 8
  ret %a
}

define @alloca3() {
; X64-LABEL: <alloca3>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    lea rax, [rbp - 0x50]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
;
; ARM64-LABEL: <alloca3>:
; ARM64:         stp x29, x30, [sp, #-0xc0]!
; ARM64-NEXT:    mov x29, sp
; ARM64-NEXT:    add x0, x29, #0xa0
; ARM64-NEXT:    ldp x29, x30, [sp], #0xc0
; ARM64-NEXT:    ret
entry:
  %a = alloca 22, 8
  ret %a
}


define @alloca4() {
; X64-LABEL: <alloca4>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    lea rax, [rbp - 0x30]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
;
; ARM64-LABEL: <alloca4>:
; ARM64:         stp x29, x30, [sp, #-0xd0]!
; ARM64-NEXT:    mov x29, sp
; ARM64-NEXT:    add x0, x29, #0xc0
; ARM64-NEXT:    ldp x29, x30, [sp], #0xd0
; ARM64-NEXT:    ret
entry:
  %a = alloca 24, 8
  %b = alloca 8, 8
  ret %b
}

define @alloca5() {
; X64-LABEL: <alloca5>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    lea rax, [rbp - 0x50]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
;
; ARM64-LABEL: <alloca5>:
; ARM64:         stp x29, x30, [sp, #-0xd0]!
; ARM64-NEXT:    mov x29, sp
; ARM64-NEXT:    add x0, x29, #0xa0
; ARM64-NEXT:    ldp x29, x30, [sp], #0xd0
; ARM64-NEXT:    ret
entry:
; COM: stack allocations > 16 are aligned up to 16
  %a = alloca 24, 8
  %b = alloca 8, 8
  ret %a
}


define @alloca6() {
; X64-LABEL: <alloca6>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    lea rax, [rbp - 0x29]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
;
; ARM64-LABEL: <alloca6>:
; ARM64:         stp x29, x30, [sp, #-0xb0]!
; ARM64-NEXT:    mov x29, sp
; ARM64-NEXT:    add x0, x29, #0xa0
; ARM64-NEXT:    ldp x29, x30, [sp], #0xb0
; ARM64-NEXT:    ret
entry:
  %a = alloca 1, 1
  ret %a
}

define @alloca7() {
; X64-LABEL: <alloca7>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    lea rax, [rbp - 0x2a]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
;
; ARM64-LABEL: <alloca7>:
; ARM64:         stp x29, x30, [sp, #-0xb0]!
; ARM64-NEXT:    mov x29, sp
; ARM64-NEXT:    add x0, x29, #0xa0
; ARM64-NEXT:    ldp x29, x30, [sp], #0xb0
; ARM64-NEXT:    ret
entry:
  %a = alloca 1, 2
  ret %a
}

define @alloca8() {
; X64-LABEL: <alloca8>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    lea rax, [rbp - 0x2c]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
;
; ARM64-LABEL: <alloca8>:
; ARM64:         stp x29, x30, [sp, #-0xb0]!
; ARM64-NEXT:    mov x29, sp
; ARM64-NEXT:    add x0, x29, #0xa0
; ARM64-NEXT:    ldp x29, x30, [sp], #0xb0
; ARM64-NEXT:    ret
entry:
  %a = alloca 1, 4
  ret %a
}

define @alloca9() {
; X64-LABEL: <alloca9>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    lea rax, [rbp - 0x30]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
;
; ARM64-LABEL: <alloca9>:
; ARM64:         stp x29, x30, [sp, #-0xb0]!
; ARM64-NEXT:    mov x29, sp
; ARM64-NEXT:    add x0, x29, #0xa0
; ARM64-NEXT:    ldp x29, x30, [sp], #0xb0
; ARM64-NEXT:    ret
entry:
  %a = alloca 1, 8
  ret %a
}

define @alloca10() {
; X64-LABEL: <alloca10>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    lea rax, [rbp - 0x40]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
;
; ARM64-LABEL: <alloca10>:
; ARM64:         stp x29, x30, [sp, #-0xb0]!
; ARM64-NEXT:    mov x29, sp
; ARM64-NEXT:    add x0, x29, #0xa0
; ARM64-NEXT:    ldp x29, x30, [sp], #0xb0
; ARM64-NEXT:    ret
entry:
  %a = alloca 1, 16
  ret %a
}


define @alloca11() {
; X64-LABEL: <alloca11>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    lea rax, [rbp - 0x29]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
;
; ARM64-LABEL: <alloca11>:
; ARM64:         stp x29, x30, [sp, #-0xb0]!
; ARM64-NEXT:    mov x29, sp
; ARM64-NEXT:    add x0, x29, #0xa0
; ARM64-NEXT:    ldp x29, x30, [sp], #0xb0
; ARM64-NEXT:    ret
entry:
  %a = alloca 1, 1
  %b = alloca 1, 1
  ret %a
}

define @alloca12() {
; X64-LABEL: <alloca12>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    lea rax, [rbp - 0x2a]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
;
; ARM64-LABEL: <alloca12>:
; ARM64:         stp x29, x30, [sp, #-0xb0]!
; ARM64-NEXT:    mov x29, sp
; ARM64-NEXT:    add x0, x29, #0xa1
; ARM64-NEXT:    ldp x29, x30, [sp], #0xb0
; ARM64-NEXT:    ret
entry:
  %a = alloca 1, 1
  %b = alloca 1, 1
  ret %b
}


define @alloca13() {
; X64-LABEL: <alloca13>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    lea rax, [rbp - 0x30]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
;
; ARM64-LABEL: <alloca13>:
; ARM64:         stp x29, x30, [sp, #-0xb0]!
; ARM64-NEXT:    mov x29, sp
; ARM64-NEXT:    add x0, x29, #0xa4
; ARM64-NEXT:    ldp x29, x30, [sp], #0xb0
; ARM64-NEXT:    ret
entry:
  %a = alloca 1, 1
  %b = alloca 4, 4
  ret %b
}

define @alloca14() {
; X64-LABEL: <alloca14>:
; X64:         push rbp
; X64-NEXT:    mov rbp, rsp
; X64-NEXT:    lea rax, [rbp - 0x2c]
; X64-NEXT:    pop rbp
; X64-NEXT:    ret
;
; ARM64-LABEL: <alloca14>:
; ARM64:         stp x29, x30, [sp, #-0xb0]!
; ARM64-NEXT:    mov x29, sp
; ARM64-NEXT:    add x0, x29, #0xa2
; ARM64-NEXT:    ldp x29, x30, [sp], #0xb0
; ARM64-NEXT:    ret
entry:
  %a = alloca 1, 1
  %b = alloca 2, 2
  ret %b
}
